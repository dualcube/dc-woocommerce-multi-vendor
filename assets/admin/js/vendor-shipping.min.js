!function(h,d,e,p){h(function(){var e=e||{build:function(){this.init(),this.bindEvents()},init:function(){this.shipping_zone_table=".wcmp-shipping-zones",this.table_shipping_zone_settings=".wcmp-shipping-zone-settings",this.table_shipping_zone_methods=".wcmp-shipping-zone-methods",this.modify_shipping_methods=".modify-shipping-methods",this.modal_add_shipping_method=".wcmp-modal-add-shipping-method-modal",this.show_shipping_methods=this.table_shipping_zone_settings+" .wcmp-shipping-zone-show-method",this.add_shipping_methods=this.modal_add_shipping_method+" .wcmp-shipping-zone-add-method",this.edit_shipping_methods=this.table_shipping_zone_settings+" .edit-shipping-method",this.delete_shipping_method=this.table_shipping_zone_settings+" .delete-shipping-method",this.method_status=this.table_shipping_zone_methods+" .method-status",this.limit_zone_location=this.table_shipping_zone_settings+" #limit_zone_location"},bindEvents:function(){h(this.modify_shipping_methods).on("click",this.modify_shipping_methods_admin.bind(this)),h(document).on("zone_settings_loaded",this.zoneLoadedEvents.bind(this)),h(document.body).on("click",this.show_shipping_methods,this.showShippingMethods),h(document.body).on("wc_backbone_modal_response",this.addShippingMethod),h(document.body).on("wc_backbone_modal_response",this.updateShippingMethod),h(document.body).on("click",this.edit_shipping_methods,this.editShippingMethod),h(document.body).on("click",this.delete_shipping_method,this.deleteShippingMethod),h(document.body).on("change",this.method_status,this.toggleShippingMethod),h(document.body).on("change",this.limit_zone_location,this.limitZoneLocation),h(document.body).on("change",".wc-shipping-zone-method-selector select",this.onChangeShippingMethodSelector),this.limitZoneLocation()},modify_shipping_methods_admin:function(e,i){var t=this;h(".wcmp-shipping-zones").block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),void 0!==e&&(e.preventDefault(),i=h(e.currentTarget).data("zoneId"),vendor_id=h(e.currentTarget).data("vendor_id"));h.ajax({method:"post",url:wcmp_vendor_shipping_script_data.ajaxurl,data:{action:"admin-get-vendor-shipping-methods-by-zone",zoneID:i,vendor_id:vendor_id},success:function(e){h(t.table_shipping_zone_settings).html(e).show(),h(t.shipping_zone_table).hide()},complete:function(){h(".wcmp-shipping-zones").unblock(),h(document).trigger("zone_settings_loaded")}})},zoneLoadedEvents:function(e){this.limitZoneLocation(e)},showShippingMethods:function(e){e.preventDefault();var i=h("#zone_id").val();h(this).WCBackboneModal({template:"wcmp-modal-add-shipping-method",variable:{zone_id:i}}),h(".wc-shipping-zone-method-selector select").change()},onChangeShippingMethodSelector:function(){var e=h(this).find("option:selected").data("description");h(this).parent().find(".wc-shipping-zone-method-description").remove(),h(this).after('<div class="wc-shipping-zone-method-description">'+e+"</div>"),h(this).closest("article").height(h(this).parent().height())},addShippingMethod:function(e,i,t){if("wcmp-modal-add-shipping-method"===i){e.preventDefault();var n=t.zone_id,o=t.vendor_id,d=t.wcmp_shipping_method;if(""==n);else if(""==d);else{var s={action:"wcmp-add-shipping-method",zoneID:n,method:d,vendor_id:o};h(this.add_shipping_methods).block({message:null,overlayCSS:{background:"#fff",opacity:.6}});h.ajax({method:"post",url:p,data:s,success:function(e){if(e.success)if(o)h.ajax({method:"post",url:wcmp_vendor_shipping_script_data.ajaxurl,data:{action:"admin-get-vendor-shipping-methods-by-zone",zoneID:n,vendor_id:o},success:function(e){h(".wcmp-shipping-zone-settings").html(e).show(),h(document).trigger("zone_settings_loaded")}});else location.reload()}})}}},editShippingMethod:function(e){e.preventDefault(),h(".wcmp-shipping-zone-methods").block({message:null,overlayCSS:{background:"#fff",opacity:.6}});var i=h(e.currentTarget).data("instance_id"),t=h(e.currentTarget).data("method_id"),n=h(e.currentTarget).data("zone_id"),o=h(e.currentTarget).data("vendor_id"),d={action:"wcmp-configure-shipping-method",zoneId:n,instanceId:i,methodId:t,vendor_id:o};h("#method_id_selected").val(t),h("#instance_id_selected").val(i);h.ajax({method:"post",url:p,data:d,success:function(e){e&&(h(".wcmp-shipping-zone-methods").unblock(),h(this).WCBackboneModal({template:"wcmp-modal-update-shipping-method",variable:{methodId:t,instanceId:i,config_settings:e}}))}})},updateShippingMethod:function(e,i,t){if("wcmp-modal-update-shipping-method"===i){e.preventDefault();var n=t.method_id,o=t.instance_id,d=t.zone_id,s=t.vendor_id,a={action:"wcmp-update-shipping-method",zoneID:d,posted_data:t,args:{instance_id:o,zone_id:d,method_id:n,vendor_id:s,settings:{}}};h.ajax({method:"post",url:p,data:a,success:function(e){if(e.success)if(s)h.ajax({method:"post",url:wcmp_vendor_shipping_script_data.ajaxurl,data:{action:"admin-get-vendor-shipping-methods-by-zone",zoneID:d,vendor_id:s},success:function(e){h(".wcmp-shipping-zone-settings").html(e).show(),h(document).trigger("zone_settings_loaded")}});else location.reload();else alert(e.data)}})}},deleteShippingMethod:function(e){e.preventDefault();if(confirm(d.i18n.deleteShippingMethodConfirmation)){h(e.target).is(this.delete_shipping_method)?e.target:h(e.target).closest(this.delete_shipping_method);var i=h(e.currentTarget).data("vendor_id"),t=h(e.target).attr("data-instance_id"),n=h("#zone_id").val(),o=o={action:"wcmp-delete-shipping-method",zoneID:n,instance_id:t,vendor_id:i};if(""==n);else if(""==t);else h.ajax({method:"post",url:p,data:o,success:function(e){if(e.success)if(i)h.ajax({method:"post",url:wcmp_vendor_shipping_script_data.ajaxurl,data:{action:"admin-get-vendor-shipping-methods-by-zone",zoneID:n,vendor_id:i},success:function(e){h(".wcmp-shipping-zone-settings").html(e).show(),h(document).trigger("zone_settings_loaded")}});else location.reload();else alert(resp.data)}})}},limitZoneLocation:function(e){h("#limit_zone_location").is(":checked")?(h(".hide_if_zone_not_limited").show(),h("#select_zone_states").select2()):h(".hide_if_zone_not_limited").hide()},toggleShippingMethod:function(e){e.preventDefault();var i=h(e.target).is(":checked"),t=h(e.target).val(),n=h(e.currentTarget).data("vendor_id"),o=h("#zone_id").val(),d={action:"wcmp-toggle-shipping-method",zoneID:o,instance_id:t,checked:i,vendor_id:n};if(""==o);else if(""==t);else{h(".wcmp-container").block({message:null,overlayCSS:{background:"#fff",opacity:.6}});h.ajax({method:"post",url:wcmp_vendor_shipping_script_data.ajaxurl,data:d,success:function(e){e.success?h(".wcmp-container").unblock():(h(".wcmp-container").unblock(),alert(e.data))}})}}};h(e.build.bind(e))})}(jQuery,wcmp_vendor_shipping_script_data,wp,ajaxurl);